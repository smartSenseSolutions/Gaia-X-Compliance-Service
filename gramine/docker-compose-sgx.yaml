version: '3.8'

services:
  server:
    container_name: compliance_sgx
    image: registry.gitlab.com/gaia-x/lab/compliance/gx-compliance:feat-build-for-gramine-sgx
    devices:
      - /dev/sgx_enclave
      - /dev/sgx_provision
    environment:
      - REGISTRY_URL=${REGISTRY_URL}
      - BASE_URL=${BASE_URL}
      - APP_PATH=${APP_PATH}
      - WEB_DOCUMENT_LOADER=${WEB_DOCUMENT_LOADER}
      - dburl="bolt://db:7687"
      - X509_CERTIFICATE=${X509_CERTIFICATE}
      - privateKey=${privateKey}
    ports:
      - "3000:3000"
    volumes:
      - /var/run/aesmd/aesm.socket:/var/run/aesmd/aesm.socket
    restart: 'unless-stopped'
    dns:
      - 1.1.1.1
      - 8.8.8.8
      - 8.8.4.4
    network_mode: "bridge"
  db:
    image: memgraph/memgraph:latest
    ports:
      - "7687:7687"
    restart: 'unless-stopped'
